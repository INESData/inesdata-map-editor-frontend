<a class="btn btn__secondary back mb-2" routerLink="/mappings">{{ "mappings.mapping.mappings-list" | translate }}</a>
<div class="grid">
	<div class="col-8">
		<div class="whiteContainer pb-0">
			<div class="grid">
				<div class="col-12">
					<h1 class="category category__ontologies">{{ "ontologies.ontologies" | translate }}</h1>
					<div class="grid">
						<!-- Ontologies-->
						<div class="col-4">
							<p class="mt-1 mb-0">{{ "ontologies.ontologies" | translate }}</p>
							<div class="mappingCategory">
								<div class="flex flex-column gap-3">
									<div class="searcherContainer">
										<input class="searcher" [placeholder]="'placeholders.search' | translate" type="text" pInputText />
									</div>
									<div *ngFor="let ontology of ontologies" class="field-checkbox">
										<p-radioButton
											[inputId]="ontology.id"
											name="ontology"
											[value]="ontology"
											[(ngModel)]="selectedOntology"
											(ngModelChange)="onOntologySelect($event)"
										/>
										<label [for]="ontology.id" class="ml-2">
											{{ ontology.name }}
										</label>
									</div>
								</div>
							</div>
						</div>
						<!-- Classes-->
						<div *ngIf="selectedOntology" class="col-4">
							<p class="mt-1 mb-0">{{ "ontologies.ontology.classes" | translate }}</p>
							<div class="mappingCategory">
								<div class="flex flex-column gap-3">
									<div class="searcherContainer">
										<input class="searcher" [placeholder]="'placeholders.search' | translate" type="text" pInputText />
									</div>
									<div *ngFor="let class of classes" class="field-checkbox">
										<p-radioButton
											[inputId]="class"
											name="class"
											[value]="class"
											[(ngModel)]="selectedClass"
											(ngModelChange)="onClassSelect($event)"
										/>
										<label [for]="class" class="ml-2">
											{{ class }}
										</label>
									</div>
								</div>
								<p-button (onClick)="showDialogElement()" class="addButton addButton__plus" [label]="'labels.add-element' | translate" />
							</div>
						</div>
						<!-- Attributes-->
						<div *ngIf="selectedClass && attributes && attributes.length > 0" class="col-4">
							<p class="mt-1 mb-0">{{ "ontologies.ontology.properties" | translate }}</p>
							<div class="mappingCategory">
								<div class="flex flex-column gap-3">
									<div class="searcherContainer">
										<input class="searcher" [placeholder]="'placeholders.search' | translate" type="text" pInputText />
									</div>
									<div *ngFor="let attribute of attributes" class="field-checkbox">
										<p-radioButton [inputId]="attribute" name="attribute" [value]="attribute" [(ngModel)]="selectedAttribute" />
										<label [for]="attribute" class="ml-2">
											{{ attribute }}
										</label>
									</div>
								</div>
								<p-button (onClick)="showDialogElement()" class="addButton addButton__plus" [label]="'labels.add-element' | translate" />
							</div>
						</div>
					</div>
				</div>
				<div class="col-12 flex flex-justify-right pt-0 pb-0">
					<p-button class="btn btn__primary icon-chevron" [label]="'labels.add-output' | translate" (onClick)="addOutput()" />
				</div>
				<!-- Data Sources-->
				<div class="col-12">
					<h1 class="category category__datasources">{{ "data-sources.data-source.sources" | translate }}</h1>
					<p-dropdown
						[options]="formats"
						[(ngModel)]="selectedFormat"
						[placeholder]="'data-sources.data-source.format' | translate"
						(onChange)="getDataFromFormat($event.value)"
					></p-dropdown>

					<div class="grid mt-0">
						<!-- Source names-->
						<div *ngIf="selectedFormat && dataSources && dataSources.length > 0" class="col-4">
							<p class="mt-1 mb-0">{{ "data-sources.data-source.data" | translate }}</p>
							<div class="mappingCategory">
								<div class="flex flex-column gap-3">
									<div class="searcherContainer">
										<input class="searcher" [placeholder]="'placeholders.search' | translate" type="text" pInputText />
									</div>
									<div *ngFor="let dataSource of dataSources" class="field-checkbox">
										<p-radioButton
											[inputId]="dataSource.id"
											name="category"
											[value]="dataSource"
											[(ngModel)]="selectedSource"
											(ngModelChange)="onSourceSelected($event)"
										/>
										<label [for]="dataSource.id" class="ml-2">
											{{ dataSource.name }}
										</label>
									</div>
								</div>
							</div>
						</div>
						<!-- Fields/XPath/Tables-->
						<div *ngIf="selectedSource" class="col-4">
							<p class="mt-1 mb-0">
								{{
									(selectedFormat === "CSV"
										? "data-sources.data-source.fields"
										: selectedFormat === "XML"
											? "data-sources.data-source.xpath"
											: "data-sources.data-source.tables"
									) | translate
								}}
							</p>
							<div class="mappingCategory">
								<div class="flex flex-column gap-3">
									<div class="searcherContainer">
										<input class="searcher" [placeholder]="'placeholders.search' | translate" type="text" pInputText />
									</div>
									<div *ngFor="let fileField of fileFields" class="field-checkbox">
										<p-radioButton [inputId]="fileField.id" name="category" [value]="fileField" [(ngModel)]="selectedField" />
										<label [for]="fileField.id">
											{{ fileField }}
										</label>
									</div>
								</div>
							</div>
						</div>
						<div class="col-4">
							<p class="mt-1 mb-0">{{ "data-sources.data-source.query" | translate }}</p>
							<div class="mappingCategory mappingCategory__query">
								SELECT EMP.*,(CASE JOB WHEN'CLERK'THEN'general-office' WHEN'NIGHTGUARD'THEN'security' WHEN'ENGINEER'THEN'engineering' END)
								ROLE FROM EMP
								<p-button (onClick)="showDialogQuery()" class="addButton addButton__query" [label]="'labels.add-query' | translate" />
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!--Mappings-->
	<div class="col-4">
		<div class="whiteContainer h-full">
			<h1 class="category category__mapping mb-1">{{ "mappings.mapping.map" | translate }}</h1>
			<label for="">{{ "mappings.mapping.map-name" | translate }}</label>
			<input class="mb-2" type="text" pInputText [(ngModel)]="mappingName" (ngModelChange)="onMappingNameChange()" />
			<label for="">{{ "mappings.mapping.map-base-url" | translate }}</label>
			<input class="mb-2" type="text" pInputText [(ngModel)]="mappingBaseUrl" (ngModelChange)="onMappingBaseUrlChange()" />
			<div *ngIf="errorMessage" class="error-message">
				{{ errorMessage }}
			</div>
			<p-table *ngIf="mapping.length > 0" class="mappingTable" [value]="mapping">
				<ng-template pTemplate="header">
					<tr>
						<th id="ontology">{{ "ontologies.ontologies" | translate }}</th>
						<th id="database">{{ "data-sources.data-source.sources" | translate }}</th>
						<th id="options"></th>
					</tr>
				</ng-template>
				<ng-template pTemplate="body" let-mapping let-index="rowIndex">
					<tr>
						<td>{{ mapping.ontologyAttribute }}</td>
						<td>{{ mapping.dataSourceField }}</td>
						<td>
							<div class="flex flex-justify flex-justify-right">
								<p-button class="btn btn__icon icon-papelera mr-1" (onClick)="deletePairFromMapping(index)" />
							</div>
						</td>
					</tr>
				</ng-template>
			</p-table>
			<div class="col-12 flex flex-justify-right p-0 mt-2">
				<p-button
					class="btn btn__primary"
					[label]="mappingId ? ('mappings.mapping.edit' | translate) : ('mappings.mapping.build' | translate)"
					(click)="buildMapping()"
				/>
			</div>
		</div>
	</div>
</div>

<!--Add element dialog-->
<p-dialog
	[header]="'labels.add-element' | translate"
	[modal]="true"
	[draggable]="false"
	[(visible)]="elementDialogVisible"
	[style]="{ width: '40rem' }"
>
	<label for="">{{ "labels.name" | translate }}</label>
	<input class="mb-4" type="text" pInputText />
	<div class="flex flex-justify-right w-full">
		<p-button class="btn btn__primary" [label]="'labels.add-element' | translate" type="button" />
	</div>
</p-dialog>

<!--Add query dialog-->
<p-dialog
	[header]="'labels.add-query' | translate"
	[modal]="true"
	[draggable]="false"
	[(visible)]="queryDialogVisible"
	[style]="{ width: '40rem' }"
>
	<label for="">{{ "labels.name" | translate }}</label>
	<input class="mb-2" type="text" pInputText />
	<label for="">{{ "labels.query" | translate }}</label>
	<textarea class="textHighlight mb-4"></textarea>
	<div class="flex flex-justify-right w-full">
		<p-button class="btn btn__primary" [label]="'labels.add-query' | translate" type="button" />
	</div>
</p-dialog>
